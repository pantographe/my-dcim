<% breadcrumb.add_step(title = t(".results")) %>

<%= render Page::HeadingComponent.new(title:, breadcrumb:) %>

<div class="p-4 border-top d-flex flex-column row-gap-4">
  <turbo-frame id="search_results">
    <% if @results.any? %>
      <div class="list-group">
        <% @results.each do |record| %>
          <% if record.is_a?(Server) %>
            <% if record.is_a_pdu? %>
              <%= link_to power_distribution_unit_path(record),
                          class: "list-group-item list-group-item-action d-flex align-items-center justify-content-between",
                          data: { turbo_frame: "_top" } do %>
                <span class="bi bi-lightning-charge text-warning fs-2 me-3"></span>
                <span class="d-flex flex-column align-items-start flex-grow-1">
                  <span class="d-flex align-items-center mb-2">
                    <h5 class="me-2 mb-0"><%= record.name %></h5>
                    <%= render BadgeComponent.new(color: :light, variant: :pill) do %>
                      <span class="fw-light text-body-secondary"><%= Server.human_attribute_name(:numero_shrt) %></span>
                      <span class="font-monospace"><%= record.numero %></span>
                    <% end %>
                  </span>
                  <p class="small mb-0"><%= record.modele&.name_with_brand %></p>
                </span>
                <span class="d-inline-flex flex-column flex-lg-row column-gap-1 row-gap-2 flex-shrink-0 ms-4">
                  <%= render BadgeComponent.new(color: :primary, variant: :pill) do %>
                    <span class="bi bi-geo-alt me-1"></span>
                    <span><%= record.decorated.full_location %></span>
                  <% end %>
                  <%= render BadgeComponent.new(color: :success, variant: :pill) do %>
                    <span class="bi bi-file-minus me-1"></span>
                    <span><%= record.frame.decorated.full_name %></span>
                  <% end %>
                </span>
              <% end %>
            <% else %>
              <%= link_to server_path(record),
                          class: "list-group-item list-group-item-action d-flex align-items-center justify-content-between",
                          data: { turbo_frame: "_top" } do %>
                <span class="bi bi-hdd text-info fs-2 me-3"></span>
                <span class="d-flex flex-column align-items-start flex-grow-1">
                  <span class="d-flex align-items-center mb-2">
                    <h5 class="me-2 mb-0"><%= record.decorated.full_name %></h5>
                    <%= render BadgeComponent.new(color: :light, variant: :pill) do %>
                      <span class="fw-light text-body-secondary"><%= Server.human_attribute_name(:numero_shrt) %></span>
                      <span class="font-monospace"><%= record.numero %></span>
                    <% end %>
                  </span>
                  <p class="small mb-0"><%= record.modele&.name_with_brand %></p>
                </span>
                <span class="d-inline-flex flex-column flex-lg-row column-gap-1 row-gap-2 flex-shrink-0 ms-4">
                  <%= render BadgeComponent.new(color: :primary, variant: :pill) do %>
                    <span class="bi bi-geo-alt me-1"></span>
                    <span><%= record.decorated.full_location %></span>
                  <% end %>
                  <%= render BadgeComponent.new(color: :success, variant: :pill) do %>
                    <span class="bi bi-file-minus me-1"></span>
                    <span><%= record.decorated.frame_location %></span>
                  <% end %>
                </span>
              <% end %>
            <% end %>
          <% else %>
            <%= link_to frame_path(record),
                        class: "list-group-item list-group-item-action d-flex align-items-center justify-content-between",
                        data: { turbo_frame: "_top" } do %>
                <span class="bi bi-file-minus text-success fs-2 me-3"></span>
                <span class="d-flex flex-column align-items-start flex-grow-1">
                  <h5 class="me-2"><%= record.name %></h5>
                  <p class="small mb-0"><%= record.islet.decorated.name_with_room %></p>
                </span>
                <%= render BadgeComponent.new(color: :primary, variant: :pill) do %>
                  <span class="bi bi-geo-alt me-1"></span>
                  <span><%= record.room.name_with_site %></span>
                <% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p><%= t(".no_results_found") %></p>
    <% end %>
  </turbo-frame>
</div>

<script>
  // Focus on the first list item or at the end of the search input field if no results
  window.onload = function () {
    const firstItem = document.querySelector('#search_results a');
    if (firstItem) {
      firstItem.focus();
    } else {
      const input = document.querySelector('input[type="search"]');
      input.focus()
      input.setSelectionRange(input.value.length, input.value.length);
    }
  };
</script>
